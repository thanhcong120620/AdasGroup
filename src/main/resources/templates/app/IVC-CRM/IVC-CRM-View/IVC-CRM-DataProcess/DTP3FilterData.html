<!DOCTYPE html>
<html lang="vi" data-theme="dark" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DTP3 - Luxury Management Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <style>
      /* --- GI·ªÆ NGUY√äN STYLE LUXURY BAN ƒê·∫¶U --- */
      :root[data-theme="dark"] {
        --bg-color: #151515; --panel-bg: #1c1c1c; --gold: #ffcc33;
        --text-main: #ffffff; --text-dim: #a0a0a0; --shd-dark: #000000;
        --shd-light: #2a2a2a; --input-bg: #121212; --table-header: #ffcc33;
        --table-header-text: #000;
      }
      :root[data-theme="light"] {
        --bg-color: #e0e0e0; --panel-bg: #e0e0e0; --gold: #b8860b;
        --text-main: #222222; --text-dim: #555555; --shd-dark: #bebebe;
        --shd-light: #ffffff; --input-bg: #e0e0e0; --table-header: #333333;
        --table-header-text: #ffffff;
      }
      * { box-sizing: border-box; margin: 0; padding: 0; transition: all 0.3s; font-family: "Inter", sans-serif; }
      body { background-color: var(--bg-color); color: var(--text-main); min-height: 100vh; display: flex; flex-direction: column; overflow-y: auto; padding: 15px; min-height: 100vh;}
      
      .theme-toggle { position: fixed; top: 15px; right: 15px; z-index: 1000; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; background: var(--panel-bg); box-shadow: 4px 4px 8px var(--shd-dark), -4px -4px 8px var(--shd-light); cursor: pointer; border: 1px solid rgba(255, 204, 51, 0.2); }
      .neu-card { background: var(--panel-bg); border-radius: 15px; box-shadow: 7px 7px 15px var(--shd-dark), -7px -7px 15px var(--shd-light); border: 1px solid rgba(255, 204, 51, 0.1); padding: 15px; height: auto;}
      
      .top-container { display: flex; height: auto; gap: 20px; margin-bottom: 30px; }
      .panel-left { flex: 2.5; display: flex; flex-direction: column; gap: 15px; }
      .panel-right { flex: 1; display: flex; flex-direction: column; gap: 15px; overflow: hidden; }
      
      .control-group { display: inline-flex; flex-direction: column; margin-right: 10px; margin-bottom: 10px; vertical-align: top; }
      .label-hint { font-size: 0.7rem; color: var(--text-dim); margin-bottom: 5px; font-weight: 600; text-transform: uppercase; }

      button, .btn-link { background: var(--panel-bg); color: var(--gold); border: 1px solid rgba(255, 204, 51, 0.3); padding: 8px 12px; border-radius: 8px; box-shadow: 4px 4px 8px var(--shd-dark), -2px -2px 5px var(--shd-light); cursor: pointer; font-weight: bold; font-size: 0.8rem; text-decoration: none; display: inline-block; text-align: center; }
      button:hover { color: var(--text-main); border-color: var(--gold); }
      input, select { background: var(--input-bg); border: none; padding: 10px; color: var(--text-main); border-radius: 8px; box-shadow: inset 3px 3px 6px var(--shd-dark), inset -2px -2px 4px var(--shd-light); outline: none; font-size: 0.85rem; }
      
      .scroll-v { flex: 1; overflow-y: auto; background: rgba(0, 0, 0, 0.1); border-radius: 10px; padding: 10px; border: 1px inset var(--shd-dark); font-size: 0.8rem; }
      
      /* Table Style */
      .section-table { /* flex: 1; */ overflow: hidden; display: flex; flex-direction: column; margin-top: 10px;}
      .table-clip { flex: 1; overflow: auto; border-radius: 10px; }
      table { border-collapse: separate; border-spacing: 0; width: 100%; }
      th { background: var(--table-header); color: var(--table-header-text); position: sticky; top: 0; padding: 12px; z-index: 5; font-size: 0.65rem; text-transform: uppercase; }
      td { padding: 8px 12px; background: var(--panel-bg); border-bottom: 1px solid var(--shd-light); border-right: 1px solid var(--shd-light); white-space: nowrap; font-size: 0.65rem; }

      .pagination { display: flex; justify-content: center; align-items: center; padding: 10px 0; gap: 5px; }
      .page-link { padding: 5px 10px; color: var(--gold); text-decoration: none; border-radius: 5px; font-size: 0.8rem; }
      .page-item.active .page-link { background: var(--gold); color: #000; }
      .page-item.disabled .page-link { color: var(--text-dim); pointer-events: none; }
      
      h3 { color: var(--gold); font-size: 0.8rem; margin-bottom: 12px; border-left: 3px solid var(--gold); padding-left: 8px; text-transform: uppercase; }
      .badge-count { background: var(--gold); color: #000; padding: 2px 8px; border-radius: 10px; font-size: 0.7rem; font-weight: bold; }
    </style>
  </head>
  <body>
    <div class="theme-toggle" id="themeBtn">üåô</div>

    <div class="top-container">
      <div class="panel-left">
        <div class="neu-card">
          <h3><i class="fas fa-filter"></i> B·ªô l·ªçc kh·ªõp ch√≠nh x√°c <span class="badge-count" th:text="${DTP3FilterDataList.size()}">0</span></h3>
          <form th:action="@{/data-dtp3-filter-and-raw-pannel}" th:object="${searchRequest}" method="get">
			  

            
            <div class="control-group">
              <span class="label-hint">T√™n Zalo</span>
              <input type="text" th:field="*{zaloName}" placeholder="Ch√≠nh x√°c...">
            </div>
            <div class="control-group">
              <span class="label-hint">SƒêT 1</span>
              <input type="text" th:field="*{phoneNumber1}" placeholder="09xxxx...">
            </div>
            <div class="control-group">
              <span class="label-hint">DataType</span>
              <select th:field="*{dataType}">
                <option value="">-- T·∫•t c·∫£ --</option>
                <option th:each="t : ${allDataTypes}" th:value="${t}" th:text="${t}"></option>
              </select>
            </div>
            <div class="control-group">
              <span class="label-hint">Gi·ªõi t√≠nh</span>
              <select th:field="*{gender}">
                <option value="">-- T·∫•t c·∫£ --</option>
                <option th:each="g : ${allGenders}" th:value="${g}" th:text="${g}"></option>
              </select>
            </div>
            <div class="control-group">
              <span class="label-hint">T√¨nh tr·∫°ng</span>
              <select th:field="*{resultFollow}">
                <option value="">-- T·∫•t c·∫£ --</option>
                <option th:each="rl : ${allResultFollows}" th:value="${rl}" th:text="${rl}"></option>
              </select>
            </div>
            <div class="control-group"> <!--Day of Birth Filter-->
				<h3>Ng√†y Follow</h3>
            	<div class="control-group">
              		<span class="label-hint">T·ª´ ng√†y</spa>
              		<input type="date" th:field="*{fromDate}">
            	</div>
            	<div class="control-group">
              		<span class="label-hint">ƒê·∫øn ng√†y</span>
              		<input type="date" th:field="*{toDate}">
            	</div>
			</div>
            <div class="control-group"> <!--Day of Birth Filter-->
				<h3>Ng√†y sinh (ch∆∞a service)</h3>
            	<div class="control-group">
              		<span class="label-hint">T·ª´ ng√†y</spa>
              		<input type="date">
            	</div>
            	<div class="control-group">
              		<span class="label-hint">ƒê·∫øn ng√†y</span>
              		<input type="date">
            	</div>
			</div>
			
			
            <div class="control-group">
              <span class="label-hint">&nbsp;</span>
              <button type="submit" style="background: var(--gold); color: #000;">L·ªåC D·ªÆ LI·ªÜU</button>
            </div>            
          </form>
        </div>

        <div style="display: flex; gap: 15px; flex: 1;">
          <div class="neu-card" style="flex: 1;">
            <h3><i class="fas fa-download"></i> Xu·∫•t d·ªØ li·ªáu</h3>
            <div class="control-group" style="width: 100%;">
				<a href="/getDtp3FilterFormExcelFile" class="btn-link"> Download Form Data.xlx</a>
                <a href="/getDtp3FilterFullDataExcelFile" class="btn-link" style="margin-bottom:8px">Download To√†n b·ªô</a>
                <a href="/getFilteredDtp3DataExcelFile" class="btn-link" style="margin-bottom:8px">Download K·∫øt qu·∫£ l·ªçc</a>
                <a href="/getDtp3FilterDuplicatePhoneExcelFile" class="btn-link" >Download duplicate Phone</a>
                <a href="/getAkabizCampaignData" class="btn-link">Akabiz data Campaign - Message</a>
                <a href="/getAkabizCampaignData-no-Salutation" class="btn-link" >Download Akabiz Campaign Data - Add Friend</a>
            </div>
          </div>
          <div class="neu-card" style="flex: 1.5;">
            <h3><i class="fas fa-upload"></i> Nh·∫≠p d·ªØ li·ªáu & C·∫≠p nh·∫≠t</h3>
            <form th:action="@{/uploadAndCreateDtp3FilterData}" method="post" enctype="multipart/form-data" style="margin-bottom: 10px;">
                <span class="label-hint">T·∫°o m·ªõi t·ª´ Excel</span>
                <input type="file" name="excelFileCreateNewDtp3FilterData" style="width: 180px; padding: 5px;">
                <button type="submit">Upload</button>
            </form>
            <form th:action="@{/update-dtp3-data-by-one-field}" method="get">
                <span class="label-hint">C·∫≠p nh·∫≠t nhanh tr∆∞·ªùng d·ªØ li·ªáu</span>
                <input type="text" name="valueToUpdate" placeholder="Gi√° tr·ªã m·ªõi..." style="width: 120px;">
                <select name="fieldToUpdate" style="width: 130px;">
                    <option value="resultFollow">K·∫øt qu·∫£ Follow</option>
        				<option value="accountFollow">T√†i kho·∫£n Follow</option>
        				<option value="zaloName">T√™n Zalo</option>
        				<option value="fullName1">H·ªç v√† T√™n</option>
        				<option value="consultDiary">T√†i kho·∫£n ƒëang t∆∞∆°ng t√°c</option>
                </select>
                <button type="submit">S·ª≠a</button>
            </form>
          </div>
        </div>
      </div>

      <div class="panel-right neu-card">
        <h3><i class="fas fa-bell"></i> Th√¥ng b√°o h·ªá th·ªëng</h3>
        <div class="scroll-v" style="color: #ff4444; font-family: 'Courier New', monospace">
            <div th:each="msg : ${DTP3FilterControllerMessagesList}">
                [LOG] <span th:text="${msg}"></span>
            </div>
            <div th:if="${#lists.isEmpty(DTP3FilterControllerMessagesList)}">
                [OK] H·ªá th·ªëng s·∫µn s√†ng. Kh√¥ng c√≥ l·ªói m·ªõi.
            </div>
        </div>
        <h3><i class="fas fa-info-circle"></i> Tr·∫°ng th√°i b·∫£ng</h3>
        <div class="scroll-v">
            B·∫£ng hi·ªán ƒëang hi·ªÉn th·ªã trang <b th:text="${page.number + 1}">1</b> / <b th:text="${page.totalPages}">1</b>.<br>
            T·ªïng s·ªë b·∫£n ghi trong DB kh·ªõp v·ªõi l·ªçc: <span th:text="${DTP3FilterDataList.size()}">0</span>.<br>
            S·ª≠ d·ª•ng ph√≠m Shift + Cu·ªôn chu·ªôt ƒë·ªÉ xem c√°c c·ªôt b·ªã ·∫©n b√™n ph·∫£i.
        </div>
      </div>
    </div>

    <div class="section-table neu-card">
      <h3>B·∫£ng hi·ªÉn th·ªã d·ªØ li·ªáu t·∫≠p trung (DTP3 Management)</h3>
      <div class="table-clip">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Lo·∫°i d·ªØ li·ªáu</th>
              <th>Ngu·ªìn d·ªØ li·ªáu</th>
              <th>Ng√†y ph√°t sinh</th>
              <th>Tk t∆∞∆°ng t√°c</th>
              <th>H·ªç t√™n 1</th>
              <th>H·ªç t√™n 2</th>
              <th>T√™n</th>
              <th>Danh x∆∞ng</th>
              <th>Gi·ªõi t√≠nh</th>
              <th>Zalo Name</th>
              <th>Zalo UID</th>
              <th>Facebook Link</th>
              <th>Phone 2</th>
              <th>Phone 2</th>
              <th>Gmail</th>
              <th>Ng√†y sinh</th>
              <th>V·ªën / Ti·∫øt ki·ªám</th>
              <th>ƒê·ªãa ch·ªâ</th>
              <th>N∆°i l√†m vi·ªác</th>
              <th>S·∫£n ph·∫©m ƒë√£ mua</th>
              <th>Mix Contact</th>
              <th>H√†nh ƒë·ªông ti·∫øp</th>
              <th>Ng√†y th·ª±c hi·ªán</th>
              <th>TK Follow</th>
              <th>K·∫øt qu·∫£ Follow</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="item : ${page.content}">
              <td th:text="${item.id}" style="color:var(--gold); font-weight:bold;"></td>
              <td th:text="${item.dataType}"></td>
              <td th:text="${item.dataSource}"></td>
              <td th:text="${item.dateOfLead}"></td>
              <td th:text="${item.consultDiary}"></td>
              <td th:text="${item.fullName1}"></td>
              <td th:text="${item.fullName2}"></td>
              <td th:text="${item.lastName}"></td>
              <td th:text="${item.salutation}"></td>
              <td th:text="${item.gender}"></td>
              <td th:text="${item.zaloName}"></td>
              <td th:text="${item.zaloUid}"></td>
              <td th:text="${item.facebookLink}"></td>
              <td th:text="${item.phoneNumber1}"></td>
              <td th:text="${item.phoneNumber2}"></td>
              <td th:text="${item.gmail}"></td>
              <td th:text="${item.dateOfBirth}"></td>
              <td class="money" th:text="${item.savingsAmount}"></td>
              <td th:text="${item.address}"></td>
              <td th:text="${item.workingArea}"></td>
              <td th:text="${item.productBought}"></td>
              <td th:text="${item.mixContacts}"></td>
              <td th:text="${item.nextAction}"></td>
              <td th:text="${item.nextFollowDate}"></td>
              <td th:text="${item.accountFollow}"></td>
              <td th:text="${item.resultFollow}"></td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="pagination" th:if="${page.totalPages > 0}">
        <div class="page-item" th:classappend="${page.first} ? 'disabled'">
            <a class="page-link" th:href="@{/data-dtp3-filter-and-raw-pannel(page=0, size=${page.size}, zaloName=${searchRequest.zaloName}, phoneNumber1=${searchRequest.phoneNumber1}, dataType=${searchRequest.dataType}, gender=${searchRequest.gender}, accountFollow=${searchRequest.accountFollow}, resultFollow=${searchRequest.resultFollow}, consultDiary=${searchRequest.consultDiary})}">&laquo; ƒê·∫ßu</a>
        </div>
        
        <div class="page-item" th:each="i : ${#numbers.sequence(startPage, endPage)}" th:classappend="${i == page.number} ? 'active'">
            <a class="page-link" th:href="@{/data-dtp3-filter-and-raw-pannel(page=${i}, size=${page.size}, zaloName=${searchRequest.zaloName}, phoneNumber1=${searchRequest.phoneNumber1}, dataType=${searchRequest.dataType}, gender=${searchRequest.gender}, accountFollow=${searchRequest.accountFollow}, resultFollow=${searchRequest.resultFollow}, consultDiary=${searchRequest.consultDiary})}" th:text="${i + 1}"></a>
        </div>

        <div class="page-item" th:classappend="${page.last} ? 'disabled'">
            <a class="page-link" th:href="@{/data-dtp3-filter-and-raw-pannel(page=${page.totalPages - 1}, size=${page.size}, zaloName=${searchRequest.zaloName}, phoneNumber1=${searchRequest.phoneNumber1}, dataType=${searchRequest.dataType}, gender=${searchRequest.gender}, accountFollow=${searchRequest.accountFollow}, resultFollow=${searchRequest.resultFollow}, consultDiary=${searchRequest.consultDiary})}">Cu·ªëi &raquo;</a>
        </div>
      </div>
    </div>

    <script>
      const themeBtn = document.getElementById("themeBtn");
      const root = document.documentElement;
      themeBtn.addEventListener("click", () => {
        const currentTheme = root.getAttribute("data-theme");
        if (currentTheme === "dark") {
          root.setAttribute("data-theme", "light");
          themeBtn.innerText = "‚òÄÔ∏è";
        } else {
          root.setAttribute("data-theme", "dark");
          themeBtn.innerText = "üåô";
        }
      });
      
      document.querySelectorAll(".money").forEach(td => {
    	const value = Number(td.innerText);
    	td.innerText = value.toLocaleString("vi-VN") + " VNƒê";
  });
    </script>
  </body>
</html>