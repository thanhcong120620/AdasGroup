<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CRM - DTP3 Management</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <style>
/* Container bao ngoài bảng */
.table-responsive-container {
    max-height: 75vh; /* Chiều cao tối đa bằng 75% chiều cao màn hình */
    overflow-y: auto;  /* Cho phép cuộn dọc */
    overflow-x: auto;  /* Cho phép cuộn ngang (giữ lại từ cũ) */
    border: 1px solid #dee2e6;
    border-radius: 4px;
    position: relative;
}

/* Cố định tiêu đề bảng (Header) */
.table-responsive-container thead th {
    position: sticky;
    top: 0;            /* Dính vào đỉnh container */
    z-index: 10;       /* Đảm bảo nằm trên các dòng dữ liệu khi cuộn */
    background-color: #343a40; /* Phải có màu nền để không bị xuyên thấu */
    box-shadow: 0 2px 2px -1px rgba(0, 0, 0, 0.4); /* Đổ bóng nhẹ dưới header */
}

/* Tùy chỉnh thanh cuộn cho đẹp hơn (tùy chọn) */
.table-responsive-container::-webkit-scrollbar {
    width: 8px;  /* Độ rộng cuộn dọc */
    height: 8px; /* Độ cao cuộn ngang */
}

.table-responsive-container::-webkit-scrollbar-track {
    background: #f1f1f1;
}

.table-responsive-container::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 10px;
}

.table-responsive-container::-webkit-scrollbar-thumb:hover {
    background: #555;
}

/* Giữ nguyên các định dạng font chữ của bạn */
.table {
    font-size: 10px;
    margin-bottom: 0;
}
.table td {
    padding: 3px 3px !important;
    vertical-align: middle;
    white-space: nowrap;
}
    </style>
</head>
<body>

    <div class="container-fluid mt-3 px-4">
        <h2 class="text-center mb-4 text-primary font-weight-bold">DTP3 - DATA MANAGEMENT PANEL</h2>
        
        <div class="row">
            <!-- =============================================
                 CỘT TRÁI (2/3): HIỂN THỊ DỮ LIỆU 
            ============================================== -->
            <div class="col-lg-8">
				<!-- Form lọc -->
        <div class="card mb-4">
            <div class="card-header">Bộ lọc khớp chính xác</div>
            <div class="card-body">
                <form th:action="@{/data-dtp3-filter-and-raw-pannel}" th:object="${searchRequest}" method="get" class="row g-3">
                    <div class="col-md-3">
                        <label>Tên Zalo (Chính xác)</label>
                        <input type="text" th:field="*{zaloName}" class="form-control">
                    </div>
                    <div class="col-md-3">
                        <label>SĐT 1 (Chính xác)</label>
                        <input type="text" th:field="*{phoneNumber1}" class="form-control">
                    </div>
                    <div class="col-md-2">
                        <label>DataType</label>
                        <select th:field="*{dataType}" class="form-select">
                            <option value="">-- Tất cả --</option>
                            <option th:each="t : ${allDataTypes}" th:value="${t}" th:text="${t}"></option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label>Giới tính</label>
                        <select th:field="*{gender}" class="form-select">
                            <option value="">-- Tất cả --</option>
                            <option th:each="g : ${allGenders}" th:value="${g}" th:text="${g}"></option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label>Tình trạng dữ liệu</label>
                        <select th:field="*{resultFollow}" class="form-select">
                            <option value="">-- Tất cả --</option>
                            <option th:each="rl : ${allResultFollows}" th:value="${rl}" th:text="${rl}"></option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label>TK thực hiện</label>
                        <select th:field="*{accountFollow}" class="form-select">
                            <option value="">-- Tất cả --</option>
                            <option th:each="af : ${allAccountFollows}" th:value="${af}" th:text="${af}"></option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <label>TK thực hiện</label>
                        <select th:field="*{consultDiary}" class="form-select">
                            <option value="">-- Tất cả --</option>
                            <option th:each="cd : ${allConsultDiaries}" th:value="${cd}" th:text="${cd}"></option>
                        </select>
                    </div>
                     <div class="col-md-3">
        				<label>Từ ngày</label>
        				<input type="date" th:field="*{fromDate}" class="form-control">
    				</div>
    
    				<div class="col-md-3">
        				<label>Đến ngày</label>
        				<input type="date" th:field="*{toDate}" class="form-control">
    				</div>
    				
                    <div class="col-md-2 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary w-100">Lọc ngay</button>
                    </div>
                </form>
                
                
                <!--Form update data-->
                <form th:action="@{/update-dtp3-data-by-one-field}" method="get">
    				<input type="text"
           					name="valueToUpdate"
           					placeholder="Nhập giá trị cần lọc"
           					required />

    				<select name="fieldToUpdate">
        				<option value="resultFollow">Kết quả Follow</option>
        				<option value="accountFollow">Tài khoản Follow</option>
        				<option value="zaloName">Tên Zalo</option>
        				<option value="fullName1">Họ và Tên</option>
        				<option value="consultDiary">Tài khoản đang tương tác</option>
    				</select>

    				<button type="submit">Cập nhật</button>
				</form>
                
                
            </div>
            
            <span class="badge badge-secondary" th:text="${'Tổng cộng: ' + DTP3FilterDataList.size()}"></span>
            
        </div>

        <!-- Bảng dữ liệu -->
        <table class="table table-bordered table-striped">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Zalo Name</th>
                    <th>Full Name</th>
                    <th>Phone</th>
                    <th>Type</th>
                    <th>Gender</th>
                    <th>Account Follow</th>
                    <th>Result Follow</th>
                    <th>Consult Diary</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="item : ${page.content}">
                    <td th:text="${item.id}"></td>
                    <td th:text="${item.zaloName}"></td>
                    <td th:text="${item.fullName1}"></td>
                    <td th:text="${item.phoneNumber1}"></td>
                    <td th:text="${item.dataType}"></td>
                    <td th:text="${item.gender}"></td>
                    <td th:text="${item.accountFollow}"></td>
                    <td th:text="${item.resultFollow}"></td>
                    <td th:text="${item.consultDiary}"></td>
                </tr>
            </tbody>
        </table>

        <!-- Phân trang -->
        <!-- Phân trang tối ưu -->
	<nav th:if="${page.totalPages > 0}" aria-label="Page navigation">
    <ul class="pagination justify-content-center">
        
        <!-- Nút về Trang Đầu (First) -->
        <li class="page-item" th:classappend="${page.first} ? 'disabled'">
            <a class="page-link" th:href="@{/data-dtp3-filter-and-raw-pannel(page=0, size=${page.size}, zaloName=${searchRequest.zaloName}, fullName1=${searchRequest.fullName1}, phoneNumber1=${searchRequest.phoneNumber1}, dataType=${searchRequest.dataType}, gender=${searchRequest.gender}, accountFollow=${searchRequest.accountFollow}, resultFollow=${searchRequest.resultFollow}, consultDiary=${searchRequest.consultDiary})}">« Đầu</a>
        </li>

        <!-- Nút Trước (Previous) -->
        <li class="page-item" th:classappend="${page.first} ? 'disabled'">
            <a class="page-link" th:href="@{/data-dtp3-filter-and-raw-pannel(page=${page.number - 1}, size=${page.size}, zaloName=${searchRequest.zaloName}, fullName1=${searchRequest.fullName1}, phoneNumber1=${searchRequest.phoneNumber1}, dataType=${searchRequest.dataType}, gender=${searchRequest.gender}, accountFollow=${searchRequest.accountFollow}, resultFollow=${searchRequest.resultFollow}, consultDiary=${searchRequest.consultDiary})}">‹</a>
        </li>

        <!-- Hiển thị các số trang trong khoảng startPage -> endPage -->
        <li class="page-item" th:each="i : ${#numbers.sequence(startPage, endPage)}" 
            th:classappend="${i == page.number} ? 'active'">
            <a class="page-link" 
               th:href="@{/data-dtp3-filter-and-raw-pannel(page=${i}, size=${page.size}, 
               					zaloName=${searchRequest.zaloName},
               					fullName1=${searchRequest.fullName1}, 
               					phoneNumber1=${searchRequest.phoneNumber1}, 
               					dataType=${searchRequest.dataType}, 
               					gender=${searchRequest.gender},
               					accountFollow=${searchRequest.accountFollow},
               					resultFollow=${searchRequest.resultFollow},
               					consultDiary=${searchRequest.consultDiary},
               					fromDate=${searchRequest.fromDate}, 
               					toDate=${searchRequest.toDate})}" 
               th:text="${i + 1}"></a>
        </li>

        <!-- Nút Sau (Next) -->
        <li class="page-item" th:classappend="${page.last} ? 'disabled'">
            <a class="page-link" th:href="@{/data-dtp3-filter-and-raw-pannel(page=${page.number + 1}, size=${page.size}, zaloName=${searchRequest.zaloName}, fullName1=${searchRequest.fullName1}, phoneNumber1=${searchRequest.phoneNumber1}, dataType=${searchRequest.dataType}, gender=${searchRequest.gender}, accountFollow=${searchRequest.accountFollow}, resultFollow=${searchRequest.resultFollow}, consultDiary=${searchRequest.consultDiary})}">›</a>
        </li>

        <!-- Nút về Trang Cuối (Last) -->
        <li class="page-item" th:classappend="${page.last} ? 'disabled'">
            <a class="page-link" th:href="@{/data-dtp3-filter-and-raw-pannel(page=${page.totalPages - 1}, size=${page.size}, zaloName=${searchRequest.zaloName}, fullName1=${searchRequest.fullName1}, phoneNumber1=${searchRequest.phoneNumber1}, dataType=${searchRequest.dataType}, gender=${searchRequest.gender}, accountFollow=${searchRequest.accountFollow}, resultFollow=${searchRequest.resultFollow}, consultDiary=${searchRequest.consultDiary})}">Cuối »</a>
        </li>
    </ul>
</nav>
</div>

            <!-- =============================================
                 CỘT PHẢI (1/3): THAO TÁC & TÌM KIẾM
            ============================================== -->
            <div class="col-lg-4">
                <div class="sticky-sidebar">
                    
                    <!-- Card Tìm kiếm -->
                    <div class="card shadow-sm mb-4">
                        <div class="card-header bg-dark text-white">
                            <i class="fas fa-search mr-2"></i>Bộ lọc tìm kiếm
                        </div>
                        <div class="card-body">
                            <form th:action="@{/searchData}" method="get">
                                <div class="row">
                                    <div class="col-md-6 form-group">
                                        <label>Tên khách hàng</label>
                                        <input type="text" name="name" class="form-control form-control-sm" placeholder="Nhập tên...">
                                    </div>
                                    <div class="col-md-6 form-group">
                                        <label>Số điện thoại</label>
                                        <input type="text" name="phone" class="form-control form-control-sm" placeholder="09xxx...">
                                    </div>
                                    <div class="col-md-6 form-group">
                                        <label>Giới tính</label>
                                        <select name="gender" class="form-control form-control-sm">
                                            <option value="">-- Tất cả --</option>
                                            <option value="Nam">Nam</option>
                                            <option value="Nữ">Nữ</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6 form-group">
                                        <label>Kết quả (Result)</label>
                                        <input type="text" name="result" class="form-control form-control-sm" placeholder="Tiềm năng...">
                                    </div>
                                    <div class="col-md-6 form-group">
                                        <label>Zalo Name/UID</label>
                                        <input type="text" name="zalo" class="form-control form-control-sm">
                                    </div>
                                    <div class="col-md-6 form-group">
                                        <label>Savings (Tối thiểu)</label>
                                        <input type="number" name="minSavings" class="form-control form-control-sm" placeholder="VNĐ">
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary btn-block btn-sm mt-2">
                                    <i class="fas fa-filter mr-1"></i> Lọc dữ liệu
                                </button>
                                <a th:href="@{/refresh}" class="btn btn-outline-secondary btn-block btn-sm"> Làm mới</a>
                            </form>
                        </div>
                    </div>

                    <!-- Card Thao tác nhanh - Các chức năng tải dữ liệu -->
                    <div class="card shadow-sm border-warning">
                        <div class="card-header bg-warning text-dark">
                            <i class="fas fa-tools mr-2"></i>Thao tác hệ thống - Các chức năng tải dữ liệu
                        </div>
                        <div class="card-body action-btn-group">
                            <button class="btn btn-success btn-block" onclick="openAddModal()">
                                <i class="fas fa-plus-circle mr-1"></i> Thêm dữ liệu mới
                            </button>
                            <hr>
                            <div class="row px-2">
								
                                <div class="col-6 p-1">
                                    <button class="btn btn-outline-info btn-block btn-sm">
                                        <i class="fas fa-file-export mr-1"></i> Export Excel
                                    </button>
                                </div>
  
                                <div class="col-6 p-1">
                                    <button class="btn btn-outline-danger btn-block btn-sm">
                                        <i class="fas fa-trash-alt mr-1"></i> Xóa hàng loạt
                                    </button>
                                </div>
                                
                                <div class="col-6 p-1">
                 					<a href="/getDtp3FilterFormExcelFile" class="btn btn-outline-info btn-block btn-sm" >
                                        <i class="fas fa-file-export mr-1"></i> Download Form Data.xlx
                                    </a>
                                    
                                </div>
                                
                                <div class="col-6 p-1">
                                    <a href="/getDtp3FilterFullDataExcelFile" class="btn btn-outline-info btn-block btn-sm" >
                                        <i class="fas fa-file-export mr-1"></i>  Download tất cả dữ liệu xuống.xlx
                                    </a>
                                </div>
                                
                                <div class="col-6 p-1">
                                    <a href="/getFilteredDtp3DataExcelFile" class="btn btn-outline-info btn-block btn-sm" >
                                        <i class="fas fa-file-export mr-1"></i>  Download dữ liệu đã lọc.xlx
                                    </a>
                                </div>
                                
                                <div class="col-6 p-1">
                                    <a href="/getDtp3FilterDuplicatePhoneExcelFile" class="btn btn-outline-info btn-block btn-sm" >
                                        <i class="fas fa-file-export mr-1"></i> Download các dữ liệu trùng số điện thoại.xlx
                                    </a>
                                </div>
                                
                                <div class="col-6 p-1">
                                    <a href="/getAkabizCampaignData" class="btn btn-outline-info btn-block btn-sm" >
                                        <i class="fas fa-file-export mr-1"></i> Download Akabiz Campaign Data - Message.xlx
                                    </a>
                                </div>
                                
                                <div class="col-6 p-1">
                                    <a href="/getAkabizCampaignData-no-Salutation" class="btn btn-outline-info btn-block btn-sm" >
                                        <i class="fas fa-file-export mr-1"></i> Download Akabiz Campaign Data - Add Friend.xlx
                                    </a>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                    
                    <!-- Card Thao tác nhanh - Các chức năng upload dữ liệu -->
                    <div class="card shadow-sm border-warning">
                        <div class="card-header bg-warning text-dark">
                            <i class="fas fa-tools mr-2"></i>Thao tác hệ thống - Các chức năng upload dữ liệu
                        </div>
                        <div class="card-body action-btn-group">
                            <button class="btn btn-success btn-block" onclick="openAddModal()">
                                <i class="fas fa-plus-circle mr-1"></i> Thêm dữ liệu mới
                            </button>
                            <hr>
                            <div class="row px-2">
                                <div class="col-6 p-1">
                                    <button class="btn btn-outline-info btn-block btn-sm">
                                        <i class="fas fa-file-export mr-1"></i> Export Excel
                                    </button>
                                </div>
                                
                                <div class="col-6 p-1">
                                    <button class="btn btn-outline-danger btn-block btn-sm">
                                        <i class="fas fa-trash-alt mr-1"></i> Xóa hàng loạt
                                    </button>
                                </div>
                                
								<div class="col-12 p-1">
								    <form th:action="@{/uploadAndCreateDtp3FilterData}" method="post" enctype="multipart/form-data">
								        <div class="form-group">
								            <label for="excelFileCreateNewDtp3FilterData" class="font-weight-bold"> Upload dữ liệu mới </label>
								            <div class="input-group input-group-sm">
								                <input type="file" id="excelFileCreateNewDtp3FilterData"
								                       name="excelFileCreateNewDtp3FilterData"
								                       accept=".xlsx,.xls"
								                       class="form-control"
								                       required
								                 >
								                <div class="input-group-append">
								                    <button type="submit" class="btn btn-primary">
								                        <i class="fas fa-upload mr-1"></i> Tạo mới
								                    </button>
								                </div>
								            </div>
								        </div>
								    </form>
								</div>		
                                
								<div class="col-12 p-1">
								    <form th:action="@{/uploadAndDeleteDtp3FilterDataByPhone}" method="post" enctype="multipart/form-data">
								        <div class="form-group">
								            <label for="excelFileDeleteDtp3FilterDataByPhone" class="font-weight-bold"> Upload danh sách số điện thoại cần xóa </label>
								            <div class="input-group input-group-sm">
								                <input type="file" id="excelFileDeleteDtp3FilterDataByPhone"
								                       name="excelFileDeleteDtp3FilterDataByPhone"
								                       accept=".xlsx,.xls"
								                       class="form-control"
								                       required
								                 >
								                <div class="input-group-append">
								                    <button type="submit" class="btn btn-primary">
								                        <i class="fas fa-trash-alt mr-1"></i> Xóa
								                    </button>
								                </div>
								            </div>
								        </div>
								    </form>
								</div>		
                                
								<div class="col-12 p-1">
								    <form th:action="@{/uploadAndUpdateDtp3FilterOldDataByPhone}" method="post" enctype="multipart/form-data">
								        <div class="form-group">
								            <label for="excelFileUpdateDtp3FilterOldDataByPhone" class="font-weight-bold"> Upload dữ liệu cần cập nhật </label>
								            <div class="input-group input-group-sm">
								                <input type="file" id="excelFileUpdateDtp3FilterOldDataByPhone"
								                       name="excelFileUpdateDtp3FilterOldDataByPhone"
								                       accept=".xlsx,.xls"
								                       class="form-control"
								                       required
								                 >
								                <div class="input-group-append">
								                    <button type="submit" class="btn btn-primary">
								                        <i class="fas fa-trash-alt mr-1"></i> Cập nhật
								                    </button>
								                </div>
								            </div>
								        </div>
								    </form>
								</div>		
                                
								<div class="col-12 p-1">
								    <form th:action="@{/uploadAndUpdateAkabizResultToDTP3}" method="post" enctype="multipart/form-data">
								        <div class="form-group">
								            <label for="excelFileUpdateAkabizResultToDTP3" class="font-weight-bold"> Upload kết quả Akabiz </label>
								            <div class="input-group input-group-sm">
								                <input type="file" id="excelFileUpdateAkabizResultToDTP3"
								                       name="excelFileUpdateAkabizResultToDTP3"
								                       accept=".xlsx,.xls"
								                       class="form-control"
								                       required
								                 >
								                <div class="input-group-append">
								                    <button type="submit" class="btn btn-primary">
								                        <i class="fas fa-trash-alt mr-1"></i> Cập nhật
								                    </button>
								                </div>
								            </div>
								        </div>
								    </form>
								</div>								
                                
                            </div>
                        </div>
                    </div>
                    
                    <!-- Card Báo cáo dữ liệu -->
                    <div class="mt-3 p-3 bg-light border rounded">
                        <small class="text-muted">
                            <i class="fas fa-info-circle mr-1"></i>
                            PHẦN MÔ TẢ TÌNH TRẠNG DỮ LIỆU
                        </small>
                        <ul class="mr-1">
        					<li th:each="msg : ${DTP3FilterControllerMessagesList}" th:text="${msg}"></li>
    					</ul>
                    </div>

                    <!-- Card Hướng dẫn / Thông tin nhanh (Optional) -->
                    <div class="mt-3 p-3 bg-light border rounded">
                        <small class="text-muted">
                            <i class="fas fa-info-circle mr-1"></i>
                            Mẹo: Bạn có thể click vào biểu tượng sửa trực tiếp trên bảng hoặc dùng bộ lọc để thu hẹp phạm vi tìm kiếm.
                        </small>
                    </div>

                </div>
            </div>
            <!--=====================================================================================-->
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script th:src="@{/js/CRM-Pannel.js}"></script>
</body>
</html>